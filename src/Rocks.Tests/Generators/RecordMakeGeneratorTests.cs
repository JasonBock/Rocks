using NUnit.Framework;

namespace Rocks.Tests.Generators;

public static class RecordMakeGeneratorTests
{
	[Test]
	public static async Task GenerateAsync()
	{
		var code =
			"""
			using Rocks;
			using System;

			[assembly: RockMake<MockTests.RecordTest>]

			namespace MockTests
			{
				public record RecordTest
				{
					public RecordTest() { }

					public virtual void Foo() { }
				}
			}
			""";

		var generatedCode =
			"""
			// <auto-generated/>
			
			#pragma warning disable CS8775
			#nullable enable
			
			namespace MockTests
			{
				internal sealed class RecordTestMakeExpectations
				{
					internal global::MockTests.RecordTest Instance()
					{
						return new Mock();
					}
					internal global::MockTests.RecordTest Instance(global::MockTests.RecordTest @original)
					{
						return new Mock(@original);
					}
					
					private sealed record Mock
						: global::MockTests.RecordTest
					{
						public Mock()
						{
						}
						public Mock(global::MockTests.RecordTest @original)
							: base(@original)
						{
						}
						
						public override void Foo()
						{
						}
						public override string ToString()
						{
							return default!;
						}
						protected override bool PrintMembers(global::System.Text.StringBuilder @builder)
						{
							return default!;
						}
						public override int GetHashCode()
						{
							return default!;
						}
						protected override global::System.Type EqualityContract
						{
							get => default!;
						}
					}
				}
			}
			
			#pragma warning restore CS8775
			
			""";

		await TestAssistants.RunGeneratorAsync<RockAttributeGenerator>(code,
			[(typeof(RockAttributeGenerator), "MockTests.RecordTest_Rock_Make.g.cs", generatedCode)],
			[]);
	}
}