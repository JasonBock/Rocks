using NUnit.Framework;

namespace Rocks.Tests.Generators;

public static class ClassConstructorMakeGeneratorTests
{
	[Test]
	public static async Task GenerateAsync()
	{
		var code =
			"""
			using Rocks;
			using System;

			[assembly: RockMake<MockTests.BaseCtor>]

			namespace MockTests
			{
				public class BaseCtor
				{
					 public BaseCtor(int a, ref string b, out string c, params string[] d) { c = "c"; }

					 public virtual void Foo() { }
				}
			}
			""";

		var generatedCode =
			"""
			// <auto-generated/>
			
			#pragma warning disable CS8618
			#pragma warning disable CS8633
			#pragma warning disable CS8714
			#pragma warning disable CS8775
			
			#nullable enable
			
			namespace MockTests
			{
				[global::System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverage]
				internal sealed class BaseCtorMakeExpectations
				{
					internal global::MockTests.BaseCtor Instance(int @a, ref string @b, out string @c, params string[] @d)
					{
						return new Mock(@a, ref @b, out @c, @d);
					}
					
					private sealed class Mock
						: global::MockTests.BaseCtor
					{
						public Mock(int @a, ref string @b, out string @c, params string[] @d)
							: base(@a, ref @b, out @c, @d)
						{
						}
						
						public override bool Equals(object? @obj)
						{
							return default!;
						}
						public override int GetHashCode()
						{
							return default!;
						}
						public override string? ToString()
						{
							return default!;
						}
						public override void Foo()
						{
						}
					}
				}
			}
			
			#pragma warning restore CS8618
			#pragma warning restore CS8633
			#pragma warning restore CS8714
			#pragma warning restore CS8775
			
			""";

		await TestAssistants.RunGeneratorAsync<RockGenerator>(code,
			[(typeof(RockGenerator), "MockTests.BaseCtor_Rock_Make.g.cs", generatedCode)],
			[]);
	}
}